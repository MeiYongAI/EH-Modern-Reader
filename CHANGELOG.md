# Changelog

All notable changes to EH Modern Reader will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.2.0] - 2025-11-13
## [2.2.1] - 2025-11-13
## [2.2.2] - 2025-11-13
## [2.3.1] - 2025-11-13
### Fixed
- MPV 图片页链接改为使用当前站点的 origin 构造 `/s/` URL，自动兼容 e-hentai 与 exhentai。
- 为 `fetchRealImageUrl` 补充 `credentials: include` 与 `referrer`，修复 Chromium 116 环境下偶发获取失败。

## [2.3.2] - 2025-11-14
### Fixed
- 屏蔽原站 MPV 脚本残留异常 (`ehg_mpv.c.js` 访问已移除节点导致 `offsetTop` 报错)：新增 `error`/`unhandledrejection`/`window.onerror` 拦截、`console.error` 过滤与 `MutationObserver` 动态脚本移除。
- 修复顶层代码意外破坏导致的初始化不可用：重建 `extractPageData()`，健壮解析 `gid/mpvkey/pagecount/imagelist/title` 并用 DOM/referrer 兜底 `gallery_url`。
- 缩略图重复首帧问题：回退到 v2.1.8 样式逻辑（雪碧图 Canvas 裁剪 + 真实图片回退），移除后续“Gallery 小缩略图 CSS 背景定位”路径导致的偏移解析不稳定。
### Changed
- 更彻底阻断原站脚本：在注入阶段移除匹配 `ehg_mpv` 的外链与内联脚本，并在后续动态插入时拦截删除，减少控制台噪音。
### Technical
- 增强错误过滤匹配范围（含 `offsetTop` 关键字）避免误报影响调试聚焦。

## [2.3.3] - 2025-11-14
## [2.3.4] - 2025-11-14
### Added
- 评论弹窗新增浮动 “发评论” 按钮：无需滚动到底部即可快速跳转并聚焦输入框，提升长评论列表下的交互效率。
### Fixed
- 打开弹窗后默认自动展开全部评论，移除“展开评论”相关按钮与链接拦截依赖；修复展开后仍需滚动到底部才能发评论的问题。
### UX
- 评论弹窗样式更贴近原站风格；悬浮按钮具备轻微悬停动效与阴影，不遮挡评论内容；关闭弹窗时自动清理。

### Fixed
- 评论弹窗内“展开全部评论”恢复功能：拦截默认跳转回画廊行为，改为本地抓取 `?hc=1` 全量评论并替换 `#cdiv` 内容，按钮在加载/失败/已展开间状态可视化；修复展开后弹窗被关闭并滚动到原页面底部的问题（新增链接/鼠标拦截，阻断站点脚本导航）。
### Added
- 若原站缺失“展开全部评论”链接，自动注入与“关闭”按钮并列的本地展开按钮，支持重复打开时保持已展开内容。
### Technical
- 新增弹窗内部事件委托，匹配任何文本含“展开全部评论”的链接并统一走本地展开逻辑，避免重复代码与竞态。


## [2.3.0] - 2025-11-13
### Added
- 持久图片缓存：
  - MPV 主图真实 URL 缓存在 `localStorage`（带 24h TTL），并保留 `sessionStorage` 兼容；跨标签页返回时复用并预连接域名。
  - 画廊展开结果缓存已在 2.2.2 引入，继续沿用。
- 永久阅读记录：使用 `chrome.storage.local`（回退 `localStorage`）保存最后阅读页；除非手动清理，否则不会消失。

### Added
- 画廊展开结果缓存（sessionStorage）：返回画廊页时直接恢复已展开的缩略图，避免二次抓取与等待。

### Fixed/Chore
- 恢复逻辑会同步移除分页条并更新 `.gpc` 显示范围；同时重新应用占位和持久化观察。

### Fixed
- 画廊页追加缩略图在滚动后“闪没”：改为克隆 `.gdtm/.gdtl` 容器保持原有网格结构，并强制把 `data-src` 写回 `src`；新增持久化观察避免站点脚本移除。
- 灰色占位覆盖真实缩略图：移除占位背景，仅在确无图片时设置最小高度，并在图片出现后清理占位样式。
- “查看评论”菜单：与其它项统一结构（带图标与空格），对齐站点箭头样式。

### Cleanups
- 删除不再使用的 `#eh-comments-wrapper` 相关样式，保留仅用于消除分页闪现的早期样式注入。

### Added
- 全屏评论页（方案A，参考JHenTai）
  - 新增 `#eh-comment-page`：独立页面壳 + 顶部AppBar + 滚动内容区 + 悬浮“发评论”按钮
  - 桌面端优先：最大宽度980px，内容区域独立滚动
  - 系统返回键 / ESC 关闭评论页，不影响页面导航
  - “发评论”按钮在新窗口打开站点原生评论位置

### Changed
- 旧的模态弹窗路径不再触发，改为进入全屏评论页

## [2.1.16] - 2025-11-13
### Fixed
- 修复桌面端和移动端评论模态框滚动问题
- 移除panel的flex-direction布局,防止内容撑开容器
- 为#cdiv添加样式覆盖,确保评论内容不限制panel高度
- 强制overflow-y:auto生效,确保panel内部可滚动
- 桌面端和移动端现在都正确显示为可滚动的卡片窗口

## [2.1.15] - 2025-11-13
### Fixed
- 修复移动端评论模态框边界显示问题
- 为panel添加明确的内边距、圆角、边框和滚动容器
- 增强border粗细(2px)和!important优先级确保卡片样式生效
- 设置overflow-y:auto确保评论内容在panel内部滚动

## [2.1.14] - 2025-11-13
### Fixed
- 修复移动端评论模态框居中显示问题
- 在overlay的inline style中添加flex布局,确保垂直居中生效
- 增强CSS !important优先级,覆盖可能的样式冲突

## [2.1.0] - 2025-11-12

### ✨ 新增
- 评论系统双层结构：居中只读预览（克隆节点、移除 ID、禁用指针事件）+ 原始评论树迁移到独立 Modal，实现交互隔离。
- 点击式投票详情（首次点击展开，二次点击移除节点折叠），替换旧悬停展示。
- 会话级真实图片 URL 缓存（sessionStorage）+ 自动 preconnect 降低二次进入握手延迟。
- 画廊页静默自动展开缩略图（移除旧“展开”按钮与进度文本）。
- 自适应浅/深色主题扩展到评论与投票详情区域。
- 居中评论预览容器，视觉层次更清晰。

### 🔄 变更 / 改进
- 统一图片加载覆盖层：移除遗留的旧旋转/线性加载动画，仅保留环形进度覆盖层。
- 进度记忆功能暂时停用（始终从第 1 页进入），为后续更完善的历史入口铺路。
- 缩略图与横向模式骨架：优化占位比更新逻辑，解析真实 URL 中的宽高信息动态修正。
- 预取并发从 3 降到 2，降低网络瞬时压力与风控概率。
- 预取持久化写入节流（400ms 聚合写 sessionStorage）。
- 预览克隆剥离事件与标识，彻底阻断外部 hover / wheel 影响。

### 🐛 修复
- 投票详情无法折叠问题（旧版本仅隐藏，无法清除）。
- 悬停投票导致模态外区域样式污染与交互泄漏。
- 评论预览节点意外被原始事件更新（移除 ID + pointer-events）。
- 预取过程与跳页竞态下可能出现的多余请求与带宽占用（取消除目标外的 in-flight）。

### 🧹 清理
- 移除画廊“展开缩略图”按钮及其进度文本逻辑相关残余代码。
- showLoading / hideLoading 降级为空实现；旧 loading spinner 注释标记并清理冗余说明。
- README 全量重写对齐 v2.1.0；修复损坏的 RELEASE_NOTES；更新 welcome.html 版本号与链接。

### 📚 文档
- README：特性、安装、使用、键位、结构与快速升级说明重新整理。
- RELEASE_NOTES：新增 2.1.0 简洁梳理；移除重复/损坏段落。
- CHANGELOG：加入本条目并保持与 Keep a Changelog 规范。

### ⚙️ 性能 / 稳定性
- 真实图片 URL 缓存 + preconnect 提升二次进入首图展示速度。
- 预取取消策略：跳页时中止非目标页请求并裁剪预取队列。
- 手动批量加载视口缩略图（Gallery 模式）避免滚动期间洪水请求。

### 🚀 后续计划（延续 Unreleased）
- 历史记录 UI 入口重新接入后再恢复进度记忆。
- 更细粒度的设置项（可选关闭自动展开 / 调整加载覆盖层样式）。

---

## [2.1.1] - 2025-11-13

## [2.1.11] - 2025-11-13

### � 评论弹窗可读性
- 移动端进一步收紧弹窗宽度与增加外边距（overlay 内边距 16–18px），不再贴边，边框更明显。
- 小屏提升边框厚度与阴影（2px + 更强 box-shadow），同时加上浅色/深色专属 outline，四周更易辨认。
- 提升基础字号与行高（≤860px: 15px/1.6；≤600px: 16px/1.65），保证手机上阅读舒适。
- 约束最大宽度 `min(900px, 96vw)`，避免超宽视觉压迫。

- 连续横向模式：中间区域点击现在会同时切换顶栏与底部菜单（缩略图/进度条）显示状态，行为与单页模式一致。
- 评论弹窗：拦截“展开全部评论”按钮/链接的默认跳转，改为在弹窗内本地展开，防止弹窗被意外关闭。

### 🔧 细节
- 补充了日志输出以便调试中间点击切换行为。

---

## [2.1.2] - 2025-11-13

### 🧹 清理
- 画廊页面：隐藏原站点页码条 `.gpc`（例如“1 - 20，共 195 张图像”），避免与扩展提供的信息重复。

---

## [2.1.3] - 2025-11-13

### 🐛 外观
- 画廊页面：在 `document_start` 即注入隐藏 `.ptt`（顶部分页条）、`.ptb`（底部分页条）与 `.gpc`（页码统计文本），彻底消除刷新时页码区域闪现。

### ⚙️ 技术
- 新增早期 `content_script` 仅注入 `style/gallery.css`，不影响原有 `gallery.js` 的加载时机；避免脚本执行顺序改变导致的潜在副作用。

---

## [2.1.4] - 2025-11-13

### 🐛 修复
- 连续横向模式 + 反向阅读下点击视觉“左侧”可能被当成右侧，导致翻页方向偶尔反向。修复方式：在反向模式下镜像点击坐标用于分区判定，保证左/右区域语义与视觉一致。

### 🔧 调试
- 新增日志：`[EH Modern Reader] 连续模式点击区域: LEFT/RIGHT reverse=... → target=...`，便于后续追踪点击命中区域与目标页。

---

## [2.1.5] - 2025-11-13

### 🛠️ 优化与修复
- 连续横向模式：统一滚动定位的 gap 与左右 padding（8px / 12px）以匹配进入模式时的布局，避免高页码下的细微偏差；新增定位调试日志。
- 防止图片被误选中：为阅读视图、横向容器和图片增加 `user-select: none`、禁拖拽与禁 tap 高亮，消除选择时的“蓝色滤镜”。

---

## [2.1.6] - 2025-11-13

### 🎯 体验
- 首次从画廊进入（或恢复到上次阅读页）时，缩略图栏不再从 1 平滑滚动到目标页，而是“瞬移”定位到当前页，再保持后续平滑滚动。

---

## [2.1.7] - 2025-11-13

### 🛠️ 修复 / 体验
- 缩略图栏首次定位进一步提前到阅读器初始化阶段：在首图加载前即瞬间跳转到起始页（如第 100 页），彻底消除“等待图片加载后再滚动过去”的延后感。

### 🔍 参考
- 对比了 JHenTai 的左右点击翻页实现：其核心是使用 PageController/PhotoViewGallery 提供的 200ms 缓动翻页与较激进的预取策略；当前版本在不更换技术栈的前提下保持轻量改进，后续将择优吸收更一致的动画节奏与更前置的预热。

---

## [2.1.8] - 2025-11-13

### 🎮 交互手感
- 横向连续模式：替换浏览器内置 `behavior: 'smooth'` 为固定 200ms 自定义缓动（easeInOutCubic），左右点击翻页动画时长与曲线恒定，减少不同浏览器实现差异。
- 单页模式：左右点击与导航键使用 `immediate` 跳转（跳过 140ms 合并延时），提升“点击→响应”速度；仍保留滚轮/拖动等合并逻辑避免抖动。
- 预热策略：点击翻页时立即预热目标页及其相邻页（±2），降低下一次翻页的首帧等待。

### 🛠️ 内部
- 新增 `animateScrollLeft(el,target,{duration})`，可统一后续更多自定义滚动场景（如自动滚动平滑化、对齐键盘翻页动效）。
- 修复上一次补丁中 `updateThumbnailHighlight` 被意外混入导航代码导致的语法破坏问题；已还原并保持首次瞬移逻辑。

### 🔍 后续可选优化
- 将自动滚动与键盘翻页统一到同一动画管线，支持速度/时长自定义。
- 可选择性在设置中开放“点击翻页是否延时合并”开关（默认为关闭）。

---

## [2.1.9] - 2025-11-13

### 📱 移动端与通用体验
- 隐藏顶部页数信息 `#eh-page-info`，减少进入时闪现与视觉噪点（保留节点兼容脚本）。
- 全局移除 tap 高亮：统一 `-webkit-tap-highlight-color: transparent`，手机点击不再出现蓝/灰色闪烁。
- 补充 `user-select: none` 到阅读容器子节点，彻底消除长按/轻触选择导致的蓝色滤镜。

### 🗨️ 评论弹窗响应式
- 新增 `.eh-comment-panel` 样式类：通过媒体查询在窄屏收敛最大高度与内边距，防止内容超出不可见。
- 超小屏（≤600px）采用近乎全屏布局，移除圆角与多余留白；支持安全区域 `env(safe-area-inset-*)`。

### 🧩 兼容性
- 不移除页数元素，仅 CSS 隐藏，避免现有脚本引用出现 `null`。

### 🔍 后续可考虑
- 评论弹窗内联样式进一步迁移到纯 CSS，以便主题动态切换更轻量。
- 设置项新增“显示顶部页数”开关（当前默认关闭）。

---

## [2.1.10] - 2025-11-13

### 🔙 返回键行为
- 手机 / 浏览器返回键在评论弹窗打开时只关闭弹窗，不再直接离开画廊页；通过 `history.pushState` 注入占位并在关闭时自动回退释放。

### 🧩 内部细节
- 注入的历史状态键：`ehCommentModal: true`；关闭时移除 `popstate` 监听避免重复调用。

### ⚠️ 注意
- 若极端环境禁止 `pushState`（隐私模式或站点安全策略），弹窗仍正常显示，但返回键将回到上一页面（已记录警告日志）。

---

## [2.1.11] - 2025-11-13

### 📱 评论弹窗可读性
- 移动端收紧弹窗宽度与外边距，边框更明显；提升字号（15–16px）与行高，手机阅读更舒适。

---

## [2.1.12] - 2025-11-13

### 🎨 多端自适应评论弹窗（参考 JHenTai）
- **桌面端（>860px）**：传统居中弹窗，max-width 900px，保持原有视觉与交互。
- **移动端（≤860px）**：底部抽屉式（Bottom Sheet）
  - 初始高度 82vh，支持拖拽把手在 55/80/95vh 三档间吸附切换。
  - sticky header 固定标题栏，内容可独立滚动。
  - 适配 visualViewport 与安全区（刘海屏/底部手势条），软键盘弹出时自动收缩高度。
  - 字体提升至 15–16px，行高 1.6–1.65，移动阅读更清晰。
- 保持所有关闭路径（遮罩/ESC/返回键）在移动端自动清理拖拽监听，防止内存泄漏。

### 🔧 内部优化
- 移除旧的内联样式覆盖，改用媒体查询统一控制桌面/移动分支。
- 清理冗余样式规则，提升 CSS 可维护性与多端分支清晰度。

---

## [2.1.13] - 2025-11-13

### 📱 移动端评论弹窗体验优化
- **改为垂直居中卡片式**：移动端弹窗不再贴底部，改为垂直水平居中，四周留白（16–12px）。
- **自然滚动**：移除拖拽把手，内容区支持原生滚动查看所有评论，更符合常规弹窗交互。
- **尺寸优化**：
  - ≤860px：宽度 `calc(100vw - 32px)`，最大高度 `calc(100vh - 80px)`。
  - ≤600px：宽度 `calc(100vw - 24px)`，最大高度 `calc(100vh - 60px)`，字体 16px。
- **安全区适配**：刘海屏与底部手势条自动留白，软键盘弹出时收缩高度不遮挡输入区。
- **桌面端不变**：保持原有居中弹窗样式与交互。

### 🔮 后续计划
- 发表评论功能将使用独立弹窗/抽屉，不与查看评论混在一起。

---

## [2.0.0] - 2025-11-10

### 🎉 正式发行版

**重大更新** - 完整的 Gallery 模式支持 + 项目规范化

### ✨ 新增

#### 🎨 Gallery 模式（v1.3.0 合并）
- 无需 300 Hath，从 `/g/` 画廊页面直接启动阅读器
- 画廊页面自动添加"EH Modern Reader"按钮
- 支持所有阅读模式和功能（单页/横向连续）

#### 🛡️ 请求节流系统
- **并发控制** - 3 并发缩略图加载
- **间隔限制** - 250ms 请求间隔（优化自300ms）
- **滚动锁机制** - 跳页时锁定 2秒，防止洪水请求
- **智能批量加载** - 跳页后手动加载可视区域缩略图（最多10张）

### 🎨 改进

#### UI/UX
- **横向模式间距优化**
  - 卡片间距: 16px → 8px
  - 左右内边距: 16px → 12px
  - 图片填充改进：使用 `width/height: 100%` + `object-fit: contain`
- **启动按钮样式** - 去除渐变背景，与站点原生风格统一
- **菜单切换优化** - 移除 padding-top 变化，header 绝对定位覆盖，无图片位移

#### 性能
- **缩略图加载提速** - requestDelay 300ms → 250ms
- **跳页智能加载** - 目标页 + 视口内相邻缩略图批量队列化

### 🏗️ 项目规范化

#### 目录结构重组
- ✅ 创建 `docs/` 目录 - 统一存放11个文档
- ✅ 创建 `scripts/` 目录 - 统一存放5个构建脚本
- ✅ 清理 `dist/` - 只保留最新发布包
- ✅ 删除冗余文件 - `src/`, `js/`, 测试HTML, 重复脚本等10+文件

#### 文档更新
- ✅ README.md - 精简为实用说明，突出 v2.0.0 特性
- ✅ welcome.html - 全新设计，简洁明了
- ✅ .gitignore - 更新构建输出规则
- ✅ scripts/README.md - 添加脚本使用说明

### 🐛 修复
- 图片位移问题 - 菜单切换时图片不再跳动
- 横向模式图片间距过大
- 图片未充满包装容器
- 缩略图加载洪水请求

### 📝 版本说明
v2.0.0 标志着项目进入成熟稳定阶段：
- ✅ 双模式完整支持（MPV + Gallery）
- ✅ 风控机制完善（无IP封禁风险）
- ✅ UI/UX 优化完成
- ✅ 项目结构规范化
- ✅ 文档完整清晰

---

## [1.3.0] - 2025-11-10

> 注：v1.3.0 功能已合并到 v2.0.0

### ✨ 新增

#### 🎨 Gallery 模式
- **无需 300 Hath** - 从 `/g/` 画廊页面直接启动阅读器
- **启动按钮** - 画廊页面右侧自动添加"EH Modern Reader"按钮
- **完整功能** - 支持所有阅读模式和功能（单页/横向连续）

#### 🛡️ 请求节流系统
- **并发控制** - 3 并发缩略图加载，避免同时大量请求
- **间隔限制** - 每个请求间隔 250ms，防止触发风控
- **滚动锁机制** - 跳页时锁定 IntersectionObserver 2秒，阻止滚动动画期间的洪水请求
- **手动批量加载** - 跳页后手动加载可视区域缩略图（最多10张），不依赖观察器

### 🎨 改进

#### UI/UX
- **横向模式间距优化**
  - 卡片间距从 16px 缩小到 8px
  - 左右内边距从 16px 调整为 12px
  - 移除冗余 flex 居中，减少视觉留白
- **图片填充改进**
  - 横向模式图片使用 `width/height: 100%` + `object-fit: contain`
  - 彻底消除"图片未填满容器"的问题
- **启动按钮样式** - 去除渐变背景，与站点原生风格统一

#### 性能
- **缩略图加载提速** - requestDelay 从 300ms 降到 250ms
- **跳页智能加载** - 目标页 + 视口内相邻缩略图批量队列化，避免单张等待

### 🐛 修复
- 图片位移问题 - 移除 `#eh-main` 的 padding-top 变化，使用绝对定位 header 覆盖
- 横向模式图片间距过大
- 图片未充满包装容器

### 🏗️ 仓库整理
- **目录结构规范化**
  - 创建 `docs/` 目录，整理所有文档
  - 创建 `scripts/` 目录，统一构建脚本
  - 删除冗余文件：`src/`, `js/`, 测试HTML, 重复脚本
  - 清理 `dist/` 目录，只保留最新发布包
- **文档更新**
  - 更新 README 反映 v1.3.0 变更
  - 完善 .gitignore 规则
  - 添加 scripts/README.md 说明

---

## [1.2.0] - 2025-01-09

### ✨ 新增

#### 🖼️ 缩略图系统重构
- **固定占位容器** - 每个缩略图初始即创建 100×142 固定尺寸容器，防止布局跳动
- **雪碧图快速预览** - 利用站点原始 MPV 雪碧图作为即时背景，零延迟展示
- **真实图片缩略图** - 独立获取每页真实图片，Canvas 绘制，contain 缩放 + 完美居中
- **垂直水平双向居中** - 彻底消除顶部空白，缩略图完全居中展示（参考 JHenTai）
- **智能懒加载优化** - IntersectionObserver rootMargin 扩大到 600px，提前触发加载

#### 🖱️ 交互增强
- **三区点击导航** - 全新点击区域划分
  - 左侧 1/3：向左翻页
  - 中间 1/3：切换顶栏显示/隐藏
  - 右侧 1/3：向右翻页
  - 适用所有模式，覆盖整个视图区域
- **预测性预加载** - 横向模式滚轮操作时检测滚动方向，提前加载前方 4 页

#### 🛡️ 稳定性增强
- **三层兜底初始化** - 解决"无法加载图片列表"问题
  1. 早期脚本拦截变量捕获
  2. 延迟重试（等待时间从 3 秒延长到 6 秒）
  3. HTTP 回退：直接抓取页面 HTML 并解析 `imagelist`
- **CORS 优化** - 避免 Canvas 污染，直接插入 Canvas 节点而非导出 dataURL

### 🎨 改进

#### UI/UX
- **收窄设置面板** - 最大宽度从 420px 调整到 360px，更紧凑适合小屏设备
- **设置面板内边距优化** - 从 20px/24px 减少到 18px/20px
- **响应式宽度** - 从 90% 调整到 92%

#### 性能
- **缩略图加载策略** - 首屏即刻展示雪碧图预览，异步加载真实图片
- **预取并发控制** - 维持 2 并发上限，避免服务器压力
- **缓存复用** - realUrlCache 和 imageCache 避免重复请求

### 🐛 修复
- 缩略图顶部空白问题（雪碧图单元格内置留白）
- 初始化时偶发"无法加载图片列表"警告
- Canvas SecurityError: Tainted canvases may not be exported
- 缩略图跳转后位置错误（因为之前未加载导致容器高度为0）
- 设置弹窗在小屏设备上过宽

### 🔧 技术改进
- 缩略图系统从雪碧图背景定位切换到独立 Canvas 渲染
- 延长初始化等待时间并增加 fallback 机制
- 移除缩略图 dataURL 导出，直接使用 Canvas 节点

---

## [1.1.0] - 2025-01-08

### ✨ 新增
- **横向连续模式** - 全新水平滚动阅读模式
  - 自动检测当前页并更新高亮
  - 滚轮垂直映射为水平滚动
  - 瞬时跳转 vs 平滑滚动策略
  - 自动播放支持（持续滚动）
- **智能预加载系统**
  - 可配置预加载页数（0-10页）
  - 并发控制（最多 2 个并发请求）
  - 防抖机制与请求取消
  - 进度条拖动预热
- **反向阅读支持** - 一键切换左右阅读方向
- **自动播放功能**
  - 单页模式：定时翻页（0.1-120秒）
  - 横向模式：持续滚动（0.1-100 px/帧）
  - Alt+单击快速设置参数

### 🎨 改进
- 深色/浅色主题自动适配（根据 prefers-color-scheme）
- 进度条两端显示页码（当前页/总页数）
- 进度条滑块交互优化
- 缩略图容器高度增加到 160px
- 底部菜单布局优化

### 🐛 修复
- 横向模式初始化时的滚动定位
- 进度记录与恢复逻辑
- 预取队列竞态条件
- 缩略图高亮同步问题

---

## [1.0.0] - 2025-01-07

### ✨ 首次发布
- **现代化阅读器界面** - 完全替代原版 MPV
- **单页阅读模式** - 流畅的图片加载与翻页
- **深色模式** - 护眼的夜间阅读主题
- **进度记忆** - 自动保存每个画廊的阅读位置
- **缩略图导航** - 快速预览与跳转
- **键盘快捷键** - ← → Home End F11 Esc
- **鼠标操作** - 点击左右翻页，点击缩略图跳转
- **滚轮翻页** - 向下滚动自动翻页
- **进度条控制** - 拖动快速跳转
- **全屏支持** - F11 进入/退出全屏
- **响应式布局** - 适配各种屏幕尺寸
- **历史记录** - 维护最近 200 条阅读记录（localStorage）

### 🔧 技术实现
- Manifest V3 扩展
- document_start 早期脚本拦截
- 完全重写 DOM 结构
- 真实图片 URL 解析与缓存
- 图片预加载队列
- IntersectionObserver 懒加载
- localStorage 进度持久化

---

## [Unreleased]

### 计划中
- [ ] 历史记录 UI 入口
- [ ] 自定义主题与配色
- [ ] 触摸设备手势支持
- [ ] 批量下载功能
- [ ] 键盘自定义映射
- [ ] 缩略图尺寸调节

---

[1.2.0]: https://github.com/MeiYongAI/EH-Modern-Reader/releases/tag/v1.2.0
[1.1.0]: https://github.com/MeiYongAI/EH-Modern-Reader/releases/tag/v1.1.0
[1.0.0]: https://github.com/MeiYongAI/EH-Modern-Reader/releases/tag/v1.0.0
