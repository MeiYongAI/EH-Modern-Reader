# v2.3.6 更新说明

## 新增功能

### 纵向连续阅读模式

v2.3.6 版本新增了第三种阅读模式：**纵向连续**（continuous-vertical），与现有的单页和横向连续模式并列。

#### 主要特点
- **垂直滚动**：通过上下滚动浏览所有页面，类似长图阅读体验
- **智能懒加载**：仅加载视口内及附近的图片，节省带宽和内存
- **完整功能支持**：
  - 三分区点击控制（上/中/下）
  - 反向阅读（垂直翻转）
  - 进度自动跟踪
  - 缩略图同步高亮
  - 骨架屏加载动画

#### 使用方法
1. 在 MPV 页面打开设置面板
2. 在"阅读模式"中选择"纵向连续"
3. 使用鼠标滚轮或触控板上下滚动浏览

#### 技术实现
- **JavaScript**：新增 `enterContinuousVerticalMode()` 函数，约 280 行代码
- **CSS**：新增 `.eh-cv-*` 类和 `#eh-continuous-vertical` 容器样式
- **架构**：完全复用现有的 `loadImage()`、`ratioCache` 和预加载机制
- **兼容性**：与单页和横向模式无缝切换，共享所有缓存和状态

#### 性能
- 使用与横向模式相同的优化策略：
  - IntersectionObserver 懒加载（rootMargin: 1200px）
  - 视口中心页面优先加载
  - 预测滚动方向并预加载 4 张相邻图片
  - 自动取消非优先请求

## 文件变更

### 修改的文件
- `content.js`（+280 行）：
  - 添加纵向连续模式 UI 选项（line 316）
  - 实现 `enterContinuousVerticalMode()` 函数（约 line 3003）
  - 更新 `scheduleShowPage()` 支持纵向滚动（约 line 1285）
  - 更新模式切换逻辑（line 2454-2480）

- `style/reader.css`（+73 行）：
  - 添加 `#eh-continuous-vertical` 容器样式
  - 添加 `.eh-cv-wrapper` 和 `.eh-cv-card` 类
  - 骨架屏动画（`.eh-cv-skeleton`）

- `manifest.json`：版本号 2.3.5 → 2.3.6

- `CHANGELOG.md`：添加 v2.3.6 条目

- `README.md`：更新版本徽章，添加"阅读模式"章节

### 新增的文件
- `docs/VERTICAL_MODE.md`：纵向模式详细文档

## 测试建议

1. **基本功能测试**：
   - 切换到纵向模式，确认所有图片按纵向排列
   - 滚动浏览，检查懒加载是否正常工作
   - 点击上/中/下区域，验证翻页和菜单切换

2. **模式切换测试**：
   - 单页 ↔ 纵向连续
   - 横向连续 ↔ 纵向连续
   - 确认切换后滚动位置正确

3. **性能测试**：
   - 使用 100+ 页的画廊测试
   - 检查控制台是否有 rate limit 错误
   - 监控内存占用（F12 → Performance Monitor）

4. **反向阅读测试**：
   - 启用反向阅读，切换到纵向模式
   - 验证图片是否垂直翻转
   - 检查点击区域是否反转

## 升级路径

从 v2.3.5 升级到 v2.3.6：
1. 删除旧版扩展文件夹
2. 解压新版 ZIP 到相同位置
3. 在 `chrome://extensions/` 刷新扩展
4. 打开任意画廊 MPV 页面测试

所有缓存和阅读进度将自动保留（存储在 `chrome.storage.local` 和 `localStorage`）。

## 已知问题

- 初始加载时图片宽高比未知，可能出现轻微布局跳变（使用默认 0.7 比例占位）
- 大量高分辨率图片可能占用较多内存（与横向模式相同限制）

## 未来计划

- 支持自定义图片间距和内边距
- 优化大图加载（progressive JPEG 渐进式加载）
- 双栏显示支持（类似漫画阅读器）
- 触控设备手势优化
