# EH Modern Reader

> 现代化的 E-Hentai 阅读器浏览器扩展

![Version](https://img.shields.io/badge/version-1.0.0-blue)
![License](https://img.shields.io/badge/license-MIT-green)

## 📖 简介

EH Modern Reader 是一个为 E-Hentai / ExHentai 站点设计的现代化阅读器扩展，旨在替代原版 MPV 阅读器，提供更优雅、流畅的阅读体验。

### ✨ 核心特性

- 🎨 现代化 UI，深色模式
- ⚡ 智能预加载（可配置“预加载页数”，默认 2）
- 💾 真实图片 URL 与图像结果缓存，减少重复请求
- 🚫 防抖与请求取消：拖动进度条或连点只加载最终页
- �️ 滚轮交互：
  - 单页模式：滚轮上下＝前后翻页
  - 横向连续模式：垂直滚轮自动映射为水平滚动
- 🧭 横向连续模式：多页横向容器 + 懒加载，滚动时自动识别当前页与高亮
- ⏱️ 自动播放：
  - 单页模式＝定时翻页（Alt+单击按钮可设间隔）
  - 横向连续模式＝持续水平自动滚动（Alt+单击可设速度）
- ⌨️ 快捷键：翻页/全屏/面板开关等（含 P 键自动播放）
- 🎯 无缝替换原版阅读器，自动注入

## 🚀 安装方法

### Chrome / Edge

1. 下载此项目到本地
2. 打开浏览器，进入扩展管理页面：
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`
3. 开启右上角的 **"开发者模式"**
4. 点击 **"加载已解压的扩展程序"**
5. 选择项目文件夹 `eh-reader-extension`
6. 完成！访问 E-Hentai MPV 页面即可自动启用

### Firefox

1. 下载此项目到本地
2. 打开 `about:debugging#/runtime/this-firefox`
3. 点击 **"临时载入附加组件"**
4. 选择项目中的 `manifest.json`
5. 完成！

## 📋 功能说明

### 界面布局

```
┌─────────────────────────────────────────────┐
│  [←] 标题          页码      [设置][全屏][主题] │  ← 顶部工具栏
├──────┬──────────────────────────────────────┤
│      │                                      │
│ 缩略图 │          主图片显示区                 │  ← 主内容区
│ 列表  │        [← 图片 →]                    │
│      │                                      │
├──────┴──────────────────────────────────────┤
│  进度条: ════════●═══════════                │  ← 底部控制栏
│  [⏮] [页码输入] [⏭]                         │
└─────────────────────────────────────────────┘
```

### 快捷键

| 按键 | 功能 |
|------|------|
| `←` / `A` | 上一页 |
| `→` / `D` / `空格` | 下一页 |
| `Home` | 第一页 |
| `End` | 最后一页 |
| `P` | 自动播放 开/关（单页：定时翻页；横向：自动滚动）|
| `F11` | 全屏 |
| `Esc` | 退出全屏/关闭面板 |

### 鼠标操作

- 点击图片左侧：上一页
- 点击图片右侧：下一页
- 点击缩略图：跳转到对应页
- 滚轮：
  - 单页模式：上下滚动＝前后翻页
  - 横向连续模式：上下滚动映射为水平滚动（更符合触控板/鼠标滚轮习惯）

### 设置选项

- 预加载页数：数值输入（默认 2），用于控制向后预取范围
- 阅读模式：单页 / 横向连续
- 自动播放按钮（顶栏）：
  - 单页：单击开始/停止定时翻页；Alt+单击设置间隔（0.5–60s）
  - 横向：单击开始/停止自动滚动；Alt+单击设置速度（建议 2–10 px/帧）
- 缩略图悬停开关：靠近底部时显示缩略图与进度条

## 🛠️ 项目结构

```
eh-reader-extension/
├─ manifest.json          # 扩展配置文件
├─ content.js            # 内容脚本（注入页面）
├─ background.js         # 后台脚本
├─ popup.html            # 弹出窗口页面
├─ popup.js              # 弹出窗口逻辑
├─ README.md             # 说明文档
├─ style/
│  └─ reader.css         # 阅读器样式
├─ js/
│  └─ reader.js          # 阅读器核心逻辑
└─ icons/
   ├─ icon16.png         # 16x16 图标
   ├─ icon48.png         # 48x48 图标
   └─ icon128.png        # 128x128 图标
```

## 🔧 技术栈

- **纯原生开发** - HTML + CSS + JavaScript
- **浏览器扩展 API** - Manifest V3
- **现代 CSS** - Flexbox、CSS Grid、CSS Variables
- **ES6+** - 模块化、异步处理

## 📝 开发说明

### 核心实现

1. **数据提取** - 从原页面 JavaScript 中提取图片列表和配置
2. **DOM 替换** - 完全重写页面结构和样式
3. **图片加载** - 实现图片缓存和预加载机制
4. **状态管理** - 使用 localStorage 保存阅读进度和设置
5. **事件处理** - 统一的键盘、鼠标、触摸事件处理

### 与原版对比

| 特性 | 原版 MPV | EH Modern Reader |
|------|----------|------------------|
| UI 设计 | 传统布局 | 现代化设计 |
| 深色模式 | ❌ | ✅ |
| 进度记忆 | ❌ | ✅ |
| 响应式 | 部分支持 | 完全支持 |
| 预加载 | 基础 | 智能预加载 |
| 自定义设置 | 有限 | 丰富 |

## 🎯 使用场景

- ✅ 访问 `https://e-hentai.org/mpv/*` 时自动启用
- ✅ 访问 `https://exhentai.org/mpv/*` 时自动启用
- ❌ 其他页面不受影响

## 🐛 已知问题

1. 图片真实 URL 解析仍依赖页面内容抓取，未来考虑使用官方 API
2. 极端快速滚动下，懒加载与预取仍可能出现短暂等待（已加入防抖与并发上限）
3. 某些镜像或网络条件下可能出现跨域或超时问题

## 🔮 未来计划

- [ ] 完整连续阅读模式（懒加载 + 视口检测）
- [ ] 双页 / 漫画阅读排版模式
- [ ] 批量与范围下载（遵守站点规则）
- [ ] 自定义主题 & 色板
- [ ] LRU 图片缓存上限与内存占用显示
- [ ] API 获取真实图片 URL 以减少页面 HTML 解析
- [ ] 触摸设备手势支持（双指缩放 / 轻扫翻页）
- [ ] 键盘可自定义映射

## 📄 开源协议

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## ⚠️ 免责声明

本扩展仅用于学习和研究目的，不得用于商业用途。使用本扩展时请遵守当地法律法规。

## 📧 联系方式

- GitHub: [您的 GitHub 用户名]
- Email: [您的邮箱]

---

**享受更好的阅读体验！📚✨**
