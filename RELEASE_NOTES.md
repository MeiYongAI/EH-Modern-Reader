# Release Notes

## v2.3.1 (2025-11-13)
### Fixes
- MPV 图片页链接域名修正：/s/ 链接改为基于当前站点 origin 构造，自动兼容 e-hentai.org 与 exhentai.org，解决抓取失败与异常重定向。
- 旧版 Chromium 兼容性：为 `fetchRealImageUrl` 增加 `credentials: include` 与 `referrer`，修复 116.0.5845.97 环境下偶发获取失败。

---

## v2.3.0 (2025-11-13)
### Features
- 永久阅读记录：最后阅读页保存在 `chrome.storage.local`（回退 `localStorage`），跨标签/重启浏览器仍保留。
- 图片缓存增强：MPV 主图真实 URL 持久化到 `localStorage`（24h 过期），配合会话缓存提升二次进入速度。

---

## v2.2.2 (2025-11-13)
### Improvement
- 画廊缩略图展开结果会缓存于 `sessionStorage`，从单页返回画廊时可即时恢复，无需再次等待加载。

---

## v2.2.1 (2025-11-13)
### Fixes
- 画廊滚动后缩略图消失：正确克隆 `.gdtm/.gdtl` 容器并强制加载图片，加入持久化观察避免被站点脚本移除。
- 占位灰块遮挡缩略图：移除灰色背景覆盖，只在无图片时设置 `min-height`，检测到图片后自动清理占位样式。
- “查看评论”菜单与其他项对齐：补充同款小图标与空格，维持原站箭头样式。

### Cleanups
- `style/gallery.css` 移除旧的 `#eh-comments-wrapper` 预览样式，仅保留分页隐藏规则（消闪）。

---

## v2.2.0 (2025-11-13)
### Features
- 全屏评论页（方案A，参考JHenTai）
  - 顶部AppBar + 滚动内容区 + 悬浮“发评论”按钮
  - 桌面端优先体验；移动端自适应
  - 返回键/ESC 关闭，仅关闭评论页
  - 发评论在新窗口进行（避免影响阅读页）

### Notes
- 文件保存为UTF-8编码
- 旧的模态弹窗已停用，后续将考虑删除遗留代码

## v2.1.16 (2025-11-13)
### Bug Fixes
- 修复桌面端和移动端评论模态框滚动问题
- 移除panel的`display: flex; flex-direction: column;`布局,防止子元素撑开容器高度
- 为评论内容区域`#cdiv`添加CSS规则:`max-height: none; overflow: visible; height: auto`
- JS中为originalRoot设置样式确保其不会限制panel的滚动行为
- 强制`overflow-y: auto !important`和`overflow-x: hidden`
- 桌面端和移动端现在都正确显示为固定高度的可滚动卡片窗口

## v2.1.15 (2025-11-13)
### Bug Fixes
- **移动端评论模态框卡片边界修复**
  - 为panel添加明确的`padding: 16px 20px`和`border-radius: 10px`
  - 增强边框粗细至2px,提升可辨识度
  - 设置`overflow-y: auto !important`确保评论内容在panel容器内部滚动
  - 所有关键样式添加`!important`防止被覆盖
  - 现在移动端显示为清晰的卡片窗口,四周有留白,内容可滚动

## v2.1.14 (2025-11-13)
### Bug Fixes
- **移动端评论模态框居中显示修复**
  - 在overlay的inline style中直接添加`display:flex; align-items:center; justify-content:center`
  - 增强CSS的`!important`优先级以确保flexbox居中布局生效
  - 修复之前版本中模态框未正确垂直居中的问题

## v2.1.13 (2025-11-13)

移动端评论弹窗体验优化
- 改为垂直居中卡片式，四周留白，不再贴底部。
- 移除拖拽把手，支持原生滚动查看所有评论。
- 尺寸自适应：≤860px 宽度 `calc(100vw - 32px)`；≤600px 宽度收紧，字体 16px。
- 安全区与软键盘自适应，不遮挡输入区。
- 桌面端保持居中弹窗不变。

后续：发表评论将使用独立弹窗。

## v2.1.12 (2025-11-13)

多端自适应评论弹窗（参考 JHenTai）
- 桌面端：居中弹窗保持原有交互。
- 移动端：底部抽屉式，可拖拽调整 55/80/95vh 高度，sticky header，自适应安全区与软键盘。
- 字体提升（15–16px）+ 行高优化（1.6–1.65），移动阅读更清晰。
- 所有关闭路径自动清理监听，防止内存泄漏。

## v2.1.11 (2025-11-13)

评论弹窗（移动端）
- 收紧宽度与四周留白，边框更明显；加粗为 2px 并增强阴影。
- 根据浅/深色主题增加轻微 outline，边界在手机上更清晰。
- 字体更大：≤860px 为 15px；≤600px 为 16px，并提升行高。


返回键体验
- 评论弹窗开启时按系统 / 浏览器返回只关闭弹窗，不跳出当前画廊。
- 使用 `history.pushState` + `popstate` 拦截；手动关闭(按钮/遮罩/Escape)时自动调用 `history.back()` 清理栈。

兼容
- pushState 失败场景下写日志并回退到旧行为，不影响其它功能。


移动端与通用
- 顶部页数隐藏，进入阅读器更干净（节点仍保留保障脚本兼容）。
- 全局移除 tap 高亮与选择蓝色滤镜，减少点击闪烁与误选。

评论弹窗
- 新增 `.eh-comment-panel` 响应式布局：窄屏自动压缩内边距与高度；极小屏全屏显示并适配安全区域。

其它
- 本版本仅样式与结构增强，延续 v2.1.8 的滚动动效与预热策略。


## v2.1.8 (2025-11-13)

交互手感
- 横向连续模式点击翻页：改为固定 200ms 自定义缓动（easeInOutCubic），不同设备/浏览器下动效一致。
- 单页模式点击翻页：跳过 140ms 合并延时，点击立即响应；同时预热目标页及相邻页，降低下一次等待。

修复
- 还原 `updateThumbnailHighlight` 逻辑，保留首次瞬移定位，避免之前补丁混入的导航代码破坏语法。

## v2.1.7 (2025-11-13)

修复 / 体验
- 将“首次定位缩略图栏”提前到阅读器初始化阶段：在首图加载前即瞬间跳到起始页（如第 100 页），避免等待图片加载后的二次滚动。

## v2.1.6 (2025-11-13)

体验
- 初次进入阅读器（例如从第 100 页启动）时，缩略图栏直接定位到该页，不再从 1 滚动过去；后续导航仍保留平滑滚动。

## v2.1.5 (2025-11-13)

改进
- 连续横向模式：滚动定位参数与进入模式时保持一致（gap=8, padding=12），并输出调试日志帮助定位高页码点击问题。
- 图片/容器禁止选择与拖拽：添加 user-select:none、-webkit-user-drag:none，避免误选导致的蓝色高亮覆盖。

## v2.1.4 (2025-11-13)

修复
- 连续横向模式在反向阅读时点击“左侧”偶发翻页方向错误（坐标未镜像）——已改为在反向状态下镜像点击 X 坐标进行区域判定，保证视觉语义一致。
- 增加调试日志输出点击区域与目标页。

## v2.1.3 (2025-11-13)

修复/清理
- 画廊：用 document_start 注入的样式即时隐藏分页条 `.ptt/.ptb` 以及页码文本 `.gpc`，消除刷新时的短暂闪现。

## v2.1.0 (2025-11-12)

改进
- 画廊：默认静默自动展开缩略图；新增占位样式减少抖动
- 评论：新增预览（克隆只读）+ 弹窗原始树，点击分数切换投票详情（再次点击关闭）；隔离外部 hover/wheel
- MPV：真实图片 URL 会话缓存 + 预连接；更稳的预取与并发控制
- UI：深浅色自适应；移除冗余旧进度样式，仅保留环形进度覆盖层

修复
- 修复投票详情无法收起（改为删除节点）
- 修复预览被外部交互污染（移除 ID、禁用 pointer-events）

## v2.1.2 (2025-11-13)

清理
- 画廊页面：隐藏原站点页码条（如“1 - 20，共 N 张图像”），避免重复信息

## v2.1.1 (2025-11-13)

修复
- 连续横向模式：中间区域点击同步切换顶栏与底部菜单显示（与单页模式一致）
- 评论弹窗：拦截“展开全部评论”默认跳转并在弹窗内本地展开，避免弹窗被关闭

## v2.0.0 (2025-11-10)

- 首个稳定版：双模式整合、请求节流、横向模式优化、目录与文档规范化

完整历史请见 CHANGELOG.md。
